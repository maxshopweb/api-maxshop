generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model admin {
  id_admin   String?  @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  id_usuario String   @id @db.VarChar(150)
  usuarios   usuarios @relation(fields: [id_usuario], references: [id_usuario], onDelete: Cascade, onUpdate: NoAction)
}

model auditoria {
  id_aud               Int       @id @default(autoincrement())
  id_usuario           String?   @db.VarChar(150)
  fecha                DateTime? @default(now()) @db.Timestamp(6)
  accion               String?   @db.VarChar(100)
  tabla_afectada       String?   @db.VarChar(100)
  dato_anterior        Json?
  dato_despues         Json?
  user_agent           String?   @db.VarChar(255)
  endpoint             String?   @db.VarChar(255)
  estado               String?   @db.VarChar(50)
  descripcion          String?   @db.VarChar(255)
  tiempo_procesamiento Int?
  usuarios             usuarios? @relation(fields: [id_usuario], references: [id_usuario], onDelete: NoAction, onUpdate: NoAction)

  @@index([fecha], map: "idx_auditoria_fecha")
  @@index([id_usuario], map: "idx_auditoria_usuario")
}

model categoria {
  id_cat         Int         @id @default(autoincrement())
  codi_categoria String      @unique @db.VarChar(4)
  nombre         String?     @db.VarChar(100)
  descripcion    String?     @db.VarChar(255)
  activo         Boolean?    @default(true)
  creado_en      DateTime?   @default(now()) @db.Timestamp(6)
  actualizado_en DateTime?   @default(now()) @db.Timestamp(6)
  productos      productos[]

  @@index([codi_categoria], map: "idx_categoria_codigo")
}

model cliente {
  id_cliente String?  @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  id_usuario String   @id @db.VarChar(150)
  direccion  String?  @db.VarChar(255)
  altura     String?  @db.VarChar(20)
  piso       String?  @db.VarChar(20)
  dpto       String?  @db.VarChar(20)
  cod_postal Int?
  ciudad     String?  @db.VarChar(100)
  provincia  String?  @db.VarChar(100)
  usuarios   usuarios @relation(fields: [id_usuario], references: [id_usuario], onDelete: Cascade, onUpdate: NoAction)
  venta      venta[]
}

model direcciones {
  id_direccion         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  id_usuario           String?   @db.VarChar(150)
  id_venta             Int?
  nombre               String?   @db.VarChar(100)
  direccion            String?   @db.VarChar(255)
  altura               String?   @db.VarChar(20)
  piso                 String?   @db.VarChar(20)
  dpto                 String?   @db.VarChar(20)
  cod_postal           Int?
  ciudad               String?   @db.VarChar(100)
  provincia            String?   @db.VarChar(100)
  es_principal         Boolean?  @default(false)
  activo               Boolean?  @default(true)
  tipo                 String?   @db.VarChar(20)
  creado_en            DateTime? @default(now()) @db.Timestamp(6)
  actualizado_en       DateTime? @default(now()) @db.Timestamp(6)
  // Campos de geocodificación (OpenCage)
  latitud              Float?
  longitud             Float?
  direccion_formateada String?   @db.VarChar(500)
  pais                 String?   @default("Argentina") @db.VarChar(100)
  // Relaciones
  usuarios             usuarios? @relation(fields: [id_usuario], references: [id_usuario], onDelete: Cascade, onUpdate: NoAction)
  venta                venta?    @relation(fields: [id_venta], references: [id_venta], onDelete: Cascade, onUpdate: NoAction)

  @@index([id_usuario], map: "idx_direcciones_usuario")
  @@index([id_venta], map: "idx_direcciones_venta")
  @@index([es_principal], map: "idx_direcciones_principal")
  @@map("direcciones")
}

model envios {
  id_envio        String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  id_venta        Int?
  empresa_envio   String?   @db.VarChar(100)
  cod_seguimiento String?   @db.VarChar(100)
  estado_envio    String?   @db.VarChar(50)
  costo_envio     Decimal?  @db.Decimal(10, 2)
  direccion_envio String?   @db.VarChar(255)
  fecha_envio     DateTime? @db.Timestamp(6)
  fecha_entrega   DateTime? @db.Timestamp(6)
  observaciones   String?
  venta           venta?    @relation(fields: [id_venta], references: [id_venta], onDelete: NoAction, onUpdate: NoAction)
}

model eventos {
  id_evento      Int             @id @default(autoincrement())
  nombre         String?         @db.VarChar(255)
  descripcion    String?
  fecha_inicio   DateTime?       @db.Timestamp(6)
  fecha_fin      DateTime?       @db.Timestamp(6)
  tipo_descuento String?         @db.VarChar(50)
  banner_img     String?         @db.VarChar(255)
  color_tema     String?         @db.VarChar(20)
  activo         Boolean?        @default(true)
  creado_en      DateTime?       @default(now()) @db.Timestamp(6)
  url_publica    String?         @db.VarChar(255)
  reglas_evento  reglas_evento[]
  venta_detalle  venta_detalle[]
}

model grupo {
  id_grupo       Int         @id @default(autoincrement())
  codi_grupo     String      @unique @db.VarChar(4)
  nombre         String?     @db.VarChar(100)
  descripcion    String?     @db.VarChar(255)
  activo         Boolean?    @default(true)
  creado_en      DateTime?   @default(now()) @db.Timestamp(6)
  actualizado_en DateTime?   @default(now()) @db.Timestamp(6)
  productos      productos[]

  @@index([codi_grupo], map: "idx_grupo_codigo")
}

model iva {
  id_iva         Int         @id @default(autoincrement())
  codi_impuesto  String      @unique @db.VarChar(2)
  nombre         String?     @db.VarChar(100)
  porcentaje     Decimal?    @db.Decimal(8, 4)
  descripcion    String?     @db.VarChar(255)
  activo         Boolean?    @default(true)
  creado_en      DateTime?   @default(now()) @db.Timestamp(6)
  actualizado_en DateTime?   @default(now()) @db.Timestamp(6)
  productos      productos[]

  @@index([codi_impuesto], map: "idx_iva_codigo")
}

model marca {
  id_marca       Int         @id @default(autoincrement())
  codi_marca     String      @unique @db.VarChar(3)
  nombre         String?     @db.VarChar(100)
  descripcion    String?     @db.VarChar(255)
  activo         Boolean?    @default(true)
  creado_en      DateTime?   @default(now()) @db.Timestamp(6)
  actualizado_en DateTime?   @default(now()) @db.Timestamp(6)
  productos      productos[]

  @@index([codi_marca], map: "idx_marca_codigo")
}

// ============================================
// TABLAS DE REFERENCIA ADICIONALES (DESDE CSV)
// ============================================

model lista_precio {
  id_lista          Int      @id @default(autoincrement())
  codi_lista        String   @unique @db.VarChar(1)   // CODILIST del CSV
  nombre            String?  @db.VarChar(15)          // DESCLIST
  tipo_lista        String?  @db.VarChar(1)           // TIPOLIST
  venta_lista       String?  @db.VarChar(1)          // VENTLIST
  activo_cuenta     Boolean?                          // ACTUCUEN (L)
  codi_forma_pago   String?  @db.VarChar(1)          // CODIFOPA
  activo_lista      String?  @db.VarChar(1)          // ACTULIST
  porc_descuento    Decimal? @db.Decimal(5, 2)       // PORCDESC
  porc_descuento_m  Decimal? @db.Decimal(5, 2)       // PORCDESC_M
  valor_lista       Decimal? @db.Decimal(5, 2)        // VALOLIST
  activo            Boolean? @default(true)
  creado_en         DateTime? @default(now()) @db.Timestamp(6)
  actualizado_en    DateTime? @default(now()) @db.Timestamp(6)

  @@index([codi_lista], map: "idx_lista_precio_codigo")
  @@map("lista_precio")
}

model situacion_fiscal {
  id_sifi           Int      @id @default(autoincrement())
  codi_sifi         String   @unique @db.VarChar(2)   // CODISIFI del CSV
  nombre            String?  @db.VarChar(25)         // DESCSIFI
  sim1_sifi         Decimal? @db.Decimal(5, 2)        // SIM1SIFI
  cuenta_venta      String?  @db.VarChar(6)          // CUE1SIFI
  cuenta_compra     String?  @db.VarChar(6)          // CUC1SIFI
  idis_sifi         String?  @db.VarChar(1)         // IDISSIFI
  idic_sifi         String?  @db.VarChar(1)         // IDICSIFI
  minimo_sifi       Decimal? @db.Decimal(15, 2)       // MINISIFI
  prbi_sifi         Decimal? @db.Decimal(5, 2)        // PRBISIFI
  prse_sifi         Decimal? @db.Decimal(5, 2)        // PRSESIFI
  codi_sucursal     String?  @db.VarChar(4)          // CODISUCU
  codi_impuesto     String?  @db.VarChar(2)          // CODIIMPU
  menos_impuesto    String?  @db.VarChar(1)          // MOINSIFI
  activo            Boolean? @default(true)
  creado_en         DateTime? @default(now()) @db.Timestamp(6)
  actualizado_en    DateTime? @default(now()) @db.Timestamp(6)

  @@index([codi_sifi], map: "idx_situacion_fiscal_codigo")
  @@map("situacion_fiscal")
}

model provincia {
  id_provincia      Int      @id @default(autoincrement())
  codi_provincia    String   @unique @db.VarChar(1)   // CODIPCIA del CSV
  nombre            String?  @db.VarChar(20)          // DESCPCIA
  alicuota_1        Decimal? @db.Decimal(5, 2)        // ALI1PCIA
  alicuota_2        Decimal? @db.Decimal(5, 2)        // ALI2PCIA
  alicuota_3        Decimal? @db.Decimal(5, 2)        // ALI3PCIA
  alicuota_4        Decimal? @db.Decimal(5, 2)        // ALI4PCIA
  activo            Boolean? @default(true)
  creado_en         DateTime? @default(now()) @db.Timestamp(6)
  actualizado_en    DateTime? @default(now()) @db.Timestamp(6)

  @@index([codi_provincia], map: "idx_provincia_codigo")
  @@map("provincia")
}

model plataforma_pago {
  id_plataforma     Int      @id @default(autoincrement())
  codi_plataforma   String   @unique @db.VarChar(2)   // CODIPLAT del CSV
  nombre            String?  @db.VarChar(30)          // DESCPLAT
  tipo_plataforma   String?  @db.VarChar(1)           // TIPOPLAT
  activo            Boolean? @default(true)
  creado_en         DateTime? @default(now()) @db.Timestamp(6)
  actualizado_en    DateTime? @default(now()) @db.Timestamp(6)

  @@index([codi_plataforma], map: "idx_plataforma_pago_codigo")
  @@map("plataforma_pago")
}

model forma_pago {
  id_forma_pago     Int      @id @default(autoincrement())
  codi_forma_pago   String   @unique @db.VarChar(1)   // CODIFOPA del CSV
  nombre            String?  @db.VarChar(20)          // DESCFOPA
  cuenta_venta      String?  @db.VarChar(6)          // CUVEFOPA
  cuenta_compra     String?  @db.VarChar(6)          // CUCOFOPA
  ico_banco         String?  @db.VarChar(1)          // ICOBFOPA
  ipag_fopa         String?  @db.VarChar(1)          // IPAGFOPA
  iven_fopa         String?  @db.VarChar(1)          // IVENFOPA
  iban_fopa         String?  @db.VarChar(1)          // IBANFOPA
  icaj_fopa         String?  @db.VarChar(1)          // ICAJFOPA
  iuni_fopa         String?  @db.VarChar(1)          // IUNIFOPA
  icom_fopa         String?  @db.VarChar(1)          // ICOMFOPA
  idis_fopa         String?  @db.VarChar(1)          // IDISFOPA
  caja_fopa         String?  @db.VarChar(1)          // CAJAFOPA
  debe_fopa         Decimal? @db.Decimal(19, 2)       // AUDEFOPA
  haber_fopa        Decimal? @db.Decimal(19, 2)      // AUCRFOPA
  codi_descuento    String?  @db.VarChar(2)          // CODIDEOP
  imod_descuento    String?  @db.VarChar(1)          // IMODDEOP
  itar_fopa         String?  @db.VarChar(1)          // ITARFOPA
  porc_fopa         Decimal? @db.Decimal(6, 2)        // PORCFOPA
  activo            Boolean? @default(true)
  creado_en         DateTime? @default(now()) @db.Timestamp(6)
  actualizado_en    DateTime? @default(now()) @db.Timestamp(6)

  @@index([codi_forma_pago], map: "idx_forma_pago_codigo")
  @@map("forma_pago")
}

model negocio {
  id_neg           Int     @id @default(autoincrement())
  nombre           String? @db.VarChar(255)
  direccion        String? @db.VarChar(255)
  logo             String? @db.VarChar(255)
  telefono         String? @db.VarChar(50)
  cuit             String? @db.VarChar(50)
  cond_iva         String? @db.VarChar(100)
  email            String? @db.VarChar(255)
  color_primario   String? @db.VarChar(20)
  color_secundario String? @db.VarChar(20)
  token_pago       String? @db.VarChar(255)
  token_envio      String? @db.Text
}

model productos {
  id_prod               Int             @id @default(autoincrement())
  codi_arti             String          @unique @db.VarChar(10)
  nombre                String?         @db.VarChar(255)
  descripcion           String?
  codi_categoria        String?         @db.VarChar(4)
  codi_marca            String?         @db.VarChar(3)
  codi_grupo            String?         @db.VarChar(4)
  codi_impuesto         String?         @db.VarChar(2)
  precio_venta          Decimal?        @db.Decimal(19, 6)   // MAESPREC ACTUPREC CODILIST=V
  precio_especial       Decimal?        @db.Decimal(19, 6)   // MAESPREC ACTUPREC CODILIST=O
  precio_pvp            Decimal?        @db.Decimal(19, 6)   // MAESPREC ACTUPREC CODILIST=P
  precio_campanya       Decimal?        @db.Decimal(19, 6)   // MAESPREC ACTUPREC CODILIST=Q
  lista_precio_activa   String?         @db.VarChar(1)      // V|O|P|Q - lista en vivo
  unidad_medida         String?         @db.VarChar(3)
  unidades_por_producto Decimal?        @db.Decimal(5, 0)
  codi_barras           String?         @db.VarChar(22)
  stock                 Decimal?        @db.Decimal(12, 2)
  img_principal         String?         @db.VarChar(120)
  activo                String?         @db.VarChar(1)
  estado                Int?            @default(1)
  stock_min             Int?
  imagenes              Json?
  destacado             Boolean?        @default(false)
  financiacion          Boolean?        @default(false)
  creado_en             DateTime?       @default(now()) @db.Timestamp(6)
  actualizado_en        DateTime?       @default(now()) @db.Timestamp(6)
  categoria             categoria?      @relation(fields: [codi_categoria], references: [codi_categoria])
  grupo                 grupo?          @relation(fields: [codi_grupo], references: [codi_grupo])
  iva                   iva?            @relation(fields: [codi_impuesto], references: [codi_impuesto])
  marca                 marca?          @relation(fields: [codi_marca], references: [codi_marca])
  venta_detalle         venta_detalle[]

  @@index([activo], map: "idx_productos_activo")
  @@index([codi_categoria], map: "idx_productos_categoria")
  @@index([codi_arti], map: "idx_productos_codi_arti")
  @@index([codi_barras], map: "idx_productos_codi_barras")
  @@index([codi_grupo], map: "idx_productos_grupo")
  @@index([codi_impuesto], map: "idx_productos_iva")
  @@index([codi_marca], map: "idx_productos_marca")
  @@index([nombre], map: "idx_productos_nombre")
}

model reglas_contenido {
  id_contenido  Int?
  id_regla      Int           @id(map: "Reglas-Contenido_pkey") @default(autoincrement())
  tipo_objetivo String?       @db.VarChar(50)
  id_objetivo   Int?
  reglas_evento reglas_evento @relation(fields: [id_regla], references: [id_regla], onDelete: NoAction, onUpdate: NoAction, map: "Reglas-Contenido_id_regla_fkey")

  @@map("reglas-contenido")
}

model reglas_evento {
  id_regla         Int               @id(map: "Reglas-Evento_pkey") @default(autoincrement())
  id_evento        Int?
  tipo_desc        String?           @db.VarChar(50)
  valor_desc       Decimal?          @db.Decimal(10, 2)
  desc_regla       String?           @db.VarChar(255)
  condicion_extra  Json?
  activo           Boolean?          @default(true)
  creado_en        DateTime?         @default(now()) @db.Timestamp(6)
  reglas_contenido reglas_contenido?
  eventos          eventos?          @relation(fields: [id_evento], references: [id_evento], onDelete: NoAction, onUpdate: NoAction, map: "Reglas-Evento_id_evento_fkey")

  @@map("reglas-evento")
}

model roles {
  id_rol      Int        @id @default(autoincrement())
  nombre      String?    @db.VarChar(100)
  descripcion String?    @db.VarChar(255)
  usuarios    usuarios[]
}

model usuarios {
  id_usuario          String      @id @db.VarChar(150)
  nombre              String?     @db.VarChar(255)
  apellido            String?     @db.VarChar(255)
  email               String?     @db.VarChar(255)
  telefono            String?     @db.VarChar(50)
  username            String?     @db.VarChar(100)
  password            String?     @db.VarChar(255)
  id_rol              Int?
  estado              Int?
  creado_en           DateTime?   @default(now()) @db.Timestamp(6)
  actualizado_en      DateTime?   @default(now()) @db.Timestamp(6)
  img                 String?     @db.VarChar(255)
  ultimo_login        DateTime?   @db.Timestamp(6)
  login_ip            String?     @db.VarChar(100)
  nacimiento          DateTime?   @db.Date
  es_anonimo          Boolean?    @default(false)
  activo              Boolean?    @default(true)
  email_no_verificado Boolean?    @default(false)
  tipo_documento      String?     @db.VarChar(10)   // DNI, CUIT, etc.
  numero_documento    String?     @db.VarChar(20)   // Número de documento
  admin               admin?
  auditoria           auditoria[]
  cliente             cliente?
  direcciones         direcciones[]
  roles               roles?      @relation(fields: [id_rol], references: [id_rol])
  venta               venta[]

  @@index([email], map: "idx_usuarios_email")
  @@index([id_usuario], map: "idx_usuarios_id_usuario")
  @@index([username], map: "idx_usuarios_username")
  @@index([numero_documento], map: "idx_usuarios_numero_documento")
}

model venta {
  id_venta              Int                     @id @default(autoincrement())
  cod_interno           String?                 @unique @db.VarChar(8)
  id_usuario            String?                 @db.VarChar(150)
  fecha                 DateTime?               @default(now()) @db.Timestamp(6)
  id_cliente            String?                 @db.VarChar(150)
  total_sin_iva         Decimal?                @db.Decimal(10, 2)
  total_con_iva         Decimal?                @db.Decimal(10, 2)
  descuento_total       Decimal?                @db.Decimal(10, 2)
  total_neto            Decimal?                @db.Decimal(10, 2)
  metodo_pago           String?                 @db.VarChar(50)
  estado_pago           String?                 @db.VarChar(50)
  estado_envio          String?                 @db.VarChar(50)
  id_envio              String?                 @db.Uuid
  tipo_venta            String?                 @db.VarChar(50)
  observaciones         String?
  factura_url           String?                 @db.VarChar(255)
  creado_en             DateTime?               @default(now()) @db.Timestamp(6)
  actualizado_en        DateTime?               @default(now()) @db.Timestamp(6)
  envios                envios[]
  cliente               cliente?                @relation(fields: [id_cliente], references: [id_usuario], onDelete: NoAction, onUpdate: NoAction)
  usuarios              usuarios?               @relation(fields: [id_usuario], references: [id_usuario], onDelete: NoAction, onUpdate: NoAction)
  venta_detalle         venta_detalle[]
  mercado_pago_payments mercado_pago_payments[]
  direcciones           direcciones[]
  ventas_pendientes_factura ventas_pendientes_factura?

  @@index([id_cliente], map: "idx_venta_cliente")
  @@index([fecha], map: "idx_venta_fecha")
  @@index([estado_pago], map: "idx_venta_estado_pago")
  @@index([cod_interno], map: "idx_venta_cod_interno")
}

model venta_detalle {
  id_detalle         Int        @id(map: "Venta-detalle_pkey") @default(autoincrement())
  id_venta           Int?
  id_prod            Int?
  cantidad           Int?
  precio_unitario    Decimal?   @db.Decimal(10, 2)
  descuento_aplicado Decimal?   @db.Decimal(10, 2)
  sub_total          Decimal?   @db.Decimal(10, 2)
  evento_aplicado    Int?
  tipo_descuento     String?    @db.VarChar(50)
  eventos            eventos?   @relation(fields: [evento_aplicado], references: [id_evento], onDelete: NoAction, onUpdate: NoAction, map: "Venta-detalle_evento_aplicado_fkey")
  productos          productos? @relation(fields: [id_prod], references: [id_prod], onDelete: NoAction, onUpdate: NoAction, map: "Venta-detalle_id_prod_fkey")
  venta              venta?     @relation(fields: [id_venta], references: [id_venta], onDelete: NoAction, onUpdate: NoAction, map: "Venta-detalle_id_venta_fkey")

  @@map("venta-detalle")
}

// ============================================
// MODELOS NUEVOS - MERCADO PAGO Y EVENT BUS
// ============================================

model mercado_pago_payments {
  id                       BigInt    @id @default(autoincrement())
  venta_id                 Int
  payment_id               String    @unique @db.VarChar(100)
  preference_id            String?   @db.VarChar(100)
  external_reference       String    @db.VarChar(255)
  status_mp                String    @db.VarChar(50)
  status_detail            String?   @db.VarChar(100)
  estado_venta_relacionado String?   @db.VarChar(50)
  payment_type_id          String    @db.VarChar(50)
  payment_method_id        String?   @db.VarChar(50)
  installments             Int?      @default(1)
  transaction_amount       Decimal   @db.Decimal(12, 2)
  total_paid_amount        Decimal?  @db.Decimal(12, 2)
  net_received_amount      Decimal?  @db.Decimal(12, 2)
  commission_amount        Decimal?  @db.Decimal(12, 2)
  fee_details              Json?
  currency_id              String    @default("ARS") @db.VarChar(3)
  operation_type           String?   @db.VarChar(50)
  date_created             DateTime  @db.Timestamp(6)
  date_approved            DateTime? @db.Timestamp(6)
  money_release_date       DateTime? @db.Timestamp(6)
  card_info                Json?
  payer_info               Json?
  processing_mode          String?   @db.VarChar(50)
  live_mode                Boolean   @default(false)
  webhook_id               BigInt?
  webhook_processed_at     DateTime? @db.Timestamp(6)
  created_at               DateTime  @default(now()) @db.Timestamp(6)
  updated_at               DateTime  @default(now()) @db.Timestamp(6)
  notes                    String?   @db.Text
  venta                    venta     @relation(fields: [venta_id], references: [id_venta], onDelete: Cascade, onUpdate: NoAction)

  @@index([venta_id], map: "idx_mp_payments_venta")
  @@index([status_mp], map: "idx_mp_payments_status")
  @@index([date_created], map: "idx_mp_payments_date")
  @@map("mercado_pago_payments")
}

model failed_webhooks {
  id            BigInt    @id @default(autoincrement())
  payment_id    String?   @db.VarChar(100)
  webhook_data  Json
  error_message String    @db.Text
  error_stack   String?   @db.Text
  retry_count   Int       @default(0)
  max_retries   Int       @default(5)
  last_retry_at DateTime? @db.Timestamp(6)
  next_retry_at DateTime? @db.Timestamp(6)
  status        String    @default("pending") @db.VarChar(20)
  created_at    DateTime  @default(now()) @db.Timestamp(6)
  updated_at    DateTime  @default(now()) @db.Timestamp(6)

  @@index([status], map: "idx_failed_webhooks_status")
  @@index([next_retry_at], map: "idx_failed_webhooks_next_retry")
  @@map("failed_webhooks")
}

model event_logs {
  id                 BigInt   @id @default(autoincrement())
  event_type         String   @db.VarChar(100)
  payload            Json
  handlers_executed  Int      @default(0)
  handlers_succeeded Int      @default(0)
  handlers_failed    Int      @default(0)
  total_duration_ms  Int?
  handler_results    Json?
  source             String?  @db.VarChar(100)
  triggered_by       String?  @db.VarChar(150)
  created_at         DateTime @default(now()) @db.Timestamp(6)

  @@index([event_type], map: "idx_event_logs_type")
  @@index([created_at], map: "idx_event_logs_date")
  @@map("event_logs")
}

model ventas_pendientes_factura {
  id                    BigInt    @id @default(autoincrement())
  venta_id              Int       @unique
  fecha_creacion         DateTime  @default(now()) @db.Timestamp(6)
  fecha_ultimo_intento   DateTime? @db.Timestamp(6)
  intentos              Int       @default(0)
  estado                 String    @default("pendiente") @db.VarChar(50)
  error_mensaje          String?   @db.Text
  factura_encontrada     Boolean   @default(false)
  factura_nombre_archivo String?   @db.VarChar(255)
  procesado_en           DateTime? @db.Timestamp(6)
  
  venta                  venta     @relation(fields: [venta_id], references: [id_venta], onDelete: Cascade)
  
  @@index([estado], map: "idx_pendientes_factura_estado")
  @@index([fecha_creacion], map: "idx_pendientes_factura_fecha")
  @@index([venta_id], map: "idx_pendientes_factura_venta")
  @@map("ventas_pendientes_factura")
}
